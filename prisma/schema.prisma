generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

enum RoleAdmin {
  admin
  master_admin
  pimpinan
}

// ==========================================================
// PERUBAHAN 1: Semua status diubah ke huruf kecil
// ==========================================================
enum StatusPengaduan {
  pending       // <-- Default
  diterima
  diproses
  ditolak
  dilaksanakan
  selesai
}

model admin {
  id           Int          @id @default(autoincrement())
  nama_lengkap String
  username     String       @unique
  password     String
  role         RoleAdmin    @default(admin)
  createdAt    DateTime     @default(now())
  pengumuman   Pengumuman[]
}

model kategori {
  id            Int         @id @default(autoincrement())
  nama_kategori String      @unique
  deskripsi     String
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt
  pengaduan     pengaduan[]
}

model lampiran {
  id          Int       @id @default(autoincrement())
  pengaduanId Int
  filePath    String
  createdAt   DateTime  @default(now())
  pengaduan   pengaduan @relation(fields: [pengaduanId], references: [id])

  @@index([pengaduanId])
}

model pengaduan {
  id         Int      @id @default(autoincrement())
  kategoriId Int
  userId     Int?
  judul      String
  deskripsi  String
  lokasi     String

  // ==========================================================
  // PERUBAHAN 2: Tipe data dan default sudah sesuai
  // ==========================================================
  status     StatusPengaduan @default(pending) // <-- Default 'pending'

  createdAt  DateTime   @default(now())
  updatedAt  DateTime   @updatedAt
  lampiran   lampiran[]
  kategori   kategori   @relation(fields: [kategoriId], references: [id])
  user       user?      @relation(fields: [userId], references: [id])

  @@index([kategoriId])
  @@index([userId])
}

model user {
  id           Int         @id @default(autoincrement())
  nama_lengkap String
  nik          String      @unique
  no_hp        String
  alamat       String
  username     String      @unique
  password     String
  createdAt    DateTime    @default(now())
  updatedAt    DateTime    @updatedAt
  pengaduan    pengaduan[]
}

model Pengumuman {
  id         Int      @id @default(autoincrement())
  judul      String
  isi        String
  gambar     String?
  dibuatPada DateTime @default(now())
  dibuatOleh Int
  admin      admin    @relation(fields: [dibuatOleh], references: [id])
}